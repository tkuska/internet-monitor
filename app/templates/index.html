<!DOCTYPE html>
<html lang="pl" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <title>Internet Monitor</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-body-secondary">

<div class="container my-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>üì° Internet Monitor</h2>

        <div>
            <a href="?range=24h" class="btn btn-sm btn-outline-primary {% if range=='24h' %}active{% endif %}">24h</a>
            <a href="?range=7d" class="btn btn-sm btn-outline-primary {% if range=='7d' %}active{% endif %}">7 dni</a>
            <button class="btn btn-sm btn-outline-secondary ms-2" onclick="toggleTheme()">üåô</button>
        </div>
    </div>

    {% if stats and stats.download_min < min_download %}
    <div class="alert alert-danger">
        ‚ö†Ô∏è Wykryto spadek prƒôdko≈õci poni≈ºej {{ min_download }} Mbps
    </div>
    {% endif %}

    <!-- STATYSTYKI -->
    {% if stats %}
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6>‚¨á Min</h6>
                    <strong>{{ "%.2f"|format(stats.download_min) }} Mbps</strong>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6>‚¨á Avg</h6>
                    <strong>{{ "%.2f"|format(stats.download_avg) }} Mbps</strong>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6>‚¨á Max</h6>
                    <strong>{{ "%.2f"|format(stats.download_max) }} Mbps</strong>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        ‚è≥ Brak danych pomiarowych ‚Äì czekam na pierwszy test prƒôdko≈õci. 
    </div>
    {% endif %}
    <!-- WYKRESY -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5>{{ title }}</h5>
            <canvas id="speedChart" height="120"></canvas>
        </div>
    </div>

    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5>Ping</h5>
            <canvas id="pingChart" height="80"></canvas>
        </div>
    </div>

    <!-- TABELA -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5>Ostatnie pomiary</h5>

            <div class="table-responsive">
                <table class="table table-sm table-striped">
                    <thead>
                        <tr>
                            <th>Czas</th>
                            <th>‚¨á</th>
                            <th>‚¨Ü</th>
                            <th>üì∂</th>
			    <th>üåê</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in rows %}
                        <tr class="{% if r[1] < min_download %}table-danger{% endif %}">
                            <td>{{ r[0] }}</td>
                            <td>{{ "%.2f"|format(r[1]) }}</td>
                            <td>{{ "%.2f"|format(r[2]) }}</td>
                            <td>{{ r[3] }}</td>
                            <td>
  				{% if r[4] == "wifi" %}üì∂ Wi-Fi
  				{% elif r[4] == "ethernet" %}üîå LAN
  				{% else %}‚ùì{% endif %}
			    </td>
			</tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<script>
const labels = {{ labels|safe }};
const downloads = {{ downloads|safe }};
const uploads = {{ uploads|safe }};
const pings = {{ pings|safe }};

new Chart(speedChart, {
    type: "line",
    data: {
        labels,
        datasets: [
            { label: "Download", data: downloads, borderColor: "#0d6efd", tension: 0.3 },
            { label: "Upload", data: uploads, borderColor: "#198754", tension: 0.3 }
        ]
    }
});

new Chart(pingChart, {
    type: "line",
    data: {
        labels,
        datasets: [
            { label: "Ping (ms)", data: pings, borderColor: "#dc3545", tension: 0.3 }
        ]
    }
});

function toggleTheme() {
    const html = document.documentElement;
    html.dataset.bsTheme = html.dataset.bsTheme === "dark" ? "light" : "dark";
}

setTimeout(() => location.reload(), 300000); // auto-refresh 5 min
</script>

</body>
</html>
